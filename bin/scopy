#!/usr/bin/env bash
# scopy â€” copy stdin to clipboard via OSC 52
# Works locally and over SSH; the terminal handles it either way.
# Usage: echo "hello" | scopy
#        tmux capture-pane -p -S - | scopy

set -euo pipefail

encoded=$(cat | base64 | tr -d '\n')

if [[ -n "${TMUX:-}" ]]; then
    # Wrap in tmux DCS passthrough so the sequence reaches the outer terminal.
    printf "\033Ptmux;\033\033]52;c;%s\a\033\\" "$encoded" > /dev/tty
else
    printf "\033]52;c;%s\a" "$encoded" > /dev/tty
fi
